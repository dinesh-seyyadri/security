zone-based policy firewall:

The zone-based policy firewall changes the original implementation of Cisco IOS Classic Firewall stateful inspection from the older interface-based model to a more flexible, more easily understood zone-based configuration model. 
This section focuses on the features of Cisco IOS zone-based policy firewalls and how to configure them.

1) Zone-Based Policy Firewall Overview
2) Zones and Zone Pairs
3) Introduction to Cisco Common Classification Policy Language
4) Default Policies, Traffic Flows, and Zone Interaction
5) Cisco Common Classification Policy Language Configuration Overview
6) Configuring Zone-Based Policy Firewall Class-Maps
7) Configuring Zone-Based Policy Firewall Policy-Maps
8) Exploring Cisco IOS Zone-Based Firewall

1) Zone-Based Policy Firewall Overview:

The zone-based policy firewall offers an easily understood zone-based configuration model.
Interfaces are assigned to zones, and an inspection policy is applied to traffic moving between the zones. 
You can group physical and virtual interfaces into zones. 
Interzone policies offer considerable flexibility and granularity, which enables you to apply different inspection policies to multiple host groups that are connected to the same router interface.

Zone-based policy firewalls are configured with the Cisco Common Classification Policy Language, 
which employs a hierarchical structure to define inspection for network protocols and the groups of hosts to which the inspection will be applied.

Old interface model for statefull firewall on IOS is CBAC(Context based access control).
**Default action in CBAC was to allow traffic whereas in zone based firewall default action is to deny.
In mordern zone based firewall traffic is allowed to flow only within the interfaces belonging to the same Zone.


Cisco IOS zone-based policy firewall supports the following features:
a) Stateful inspection
b) Application inspection
c) URL filtering
d) Per-policy connection parameters
e) Transparent firewall
f) Virtual routing and forwarding-aware firewall

Benefits of Zone-Based Policy Firewall:

Zones establish the security borders of your network.
A zone defines a boundary where traffic is subjected to policy restrictions as it crosses to another region of your network.
The default policy of a zone-based policy firewall between zones is to "deny all." 
If no policy is explicitly configured, all traffic moving between zones is blocked.
The Cisco Common Classification Policy Language structure is similar to the MQC structure in which class maps are used to categorize traffic and policy maps are used to specify policy to be applied to each traffic category.



2) Zones and Zone Pairs:

A zone is a collection of networks that is reachable over a specific set of router interfaces and is designated to belong to the same zone. 
Zone-based policy firewall access control policies then control access between two or more zones that are configured on the router. 
C3PL, a flexible configuration language, allows you to specify simple or complex access policies in a manageable manner.

Once zones are created, default rules apply.
Default rules generally allow unrestricted access between interfaces that belong to the same zone, while denying all interzone traffic.

***Note:

An interface can belong to only one zone.
*****

A zone pair allows you to specify a unidirectional firewall policy between two security zones, thus changing the default policy.
The direction of the traffic is indicated by specifying a source and destination zone. 
You must first define the source and destination zones before they can be referenced in a new zone pair.

The self zone is a system-defined zone. It does not have any interfaces as members.
A zone pair that includes the self zone, along with the associated policy, applies to traffic directed to the router or traffic that is generated by the router. 
It does not apply to traffic through the router.

Zone-Based Topology Examples

Not considering the self zone, with three security zones(Inside,Outside ,DMZ ), there is the potential to define policy for up to six zone pairs.


In this example, they would be:

Inside-to-outside
Inside-to-DMZ
DMZ-to-inside
DMZ-to-outside
Outside-to-DMZ
Outside-to-inside

Again, you do not necessarily have to define each of these zone pairs.

3) Introduction to Cisco Common Classification Policy Language:


To create firewall policies using C3PL, complete the following tasks:

1) Class map: Define the match criterion in a class map. Class maps identify traffic at OSI Layers 3 through 7.

2) Policy map:Associate policy actions to impose on the matched traffic with a policy map. Policy maps define policy for traffic at Layers 3 through 7.

3) Service policy: Specify where to apply a policy map by referencing the policy map and a zone pair within a service policy. Service policies activate policy maps for traffic flows on specific direction of zone pairs.


Cisco Common Classification Policy Language policies are modular, object-oriented, and hierarchical in nature.

a) Modular and object-oriented: This trait gives the firewall administrator the flexibility to create building-block objects such as class maps and policy maps, and reuse them within a given policy and across policies.

b) Hierarchical: This feature results in powerful policies that can be expanded to include customized inspection, application layer rules, and advanced inspection features. 
   These advanced policies are based on the hierarchical structure that is depicted in the figure.
   
A policy map is applied to traffic flows that traverse a zone pair by using service policies. 
The policy map processes traffic flows by matching sessions against one or more class map objects, and performing policy actions that are defined for the matched class.

In a sense, policy maps are "if-then-else" statements, something similar to saying: "If a traffic flow matches the first class map, then the associated action is performed, and no other class map in the same policy is evaluated. 
Else, if the traffic flow matches the next class map in the configuration, then the associated action is performed." 
If traffic is not matched by any class map in a policy, a default action is performed.


Class maps:

Class maps that analyze Layer 3 and Layer 4 traffic can categorize the traffic that is based on the following criteria:

Access group: A standard, extended, or named ACL can filter traffic that is based on source and destination IP addresses and source and destination ports.
Protocol: The class map can identify Layer 4 protocols such as TCP, UDP, and ICMP, and application services such as HTTP, SMTP, and DNS. Any well-known or user-defined service that is known to PAM can be specified.
Class map: A subordinate class map that provides additional match criteria can be nested inside another class map.

Each class map can have multiple match statements. The match type defines how multiple match statements are processed to match the class:

a) If match-any is specified, traffic must meet only one of the match criteria in the class map.
b) If match-all is specified, traffic must match all the class map criteria to belong to that particular class.


Policy Map:

These considerations apply to policy map creation and usage.

Class maps are evaluated in the order that they are configured and added to the policy map. 
Consider pushing the more specific traffic classes to the top of the policy, while pushing the more generic traffic definitions to the bottom.


Possible actions include inspect, pass, drop, and log. Log is only available with the drop action.
In addition to user-defined classes, a system-defined class map that is named class-default represents all packets that do not match any of the user-defined classes in a policy. 
It is always the last class in a policy map. You can define explicit actions for this group of packets.
If you do not configure any actions for class-default in an inspect policy, the default action is drop.



The Cisco IOS zone-based policy firewall supports the following three policy actions:
Action:***Description*******************************************************When to Use****  
Inspect: 	Permit and statefully track the sessions of the traffic class.	  Permit protocols that the zone-based firewall supports for inspection between zones.
Pass:   	Statelessly permit packets of the traffic class between zones.	  Permit protocols that the zone-based firewall does not support for inspection between zones.
Drop:    	Deny traffic matching the traffic class.	                        Deny specific traffic classes.
Log:     	Log packets of the traffic class.	                                Log denied traffic (can only be used with the drop action).

Service Policy Zone Pair Assignments:


Service policy assignments are unidirectional, as defined by the zone pair to which the policy map is assigned.
Zone pairs define the direction by specifying the source zone and the destination zone.
A policy map that is applied to a given zone pair will match traffic and perform action for that traffic in the direction that is defined by the zone pair.
In other words, the policy map applies to traffic originating at the source zone and flowing toward the destination zone.


Exactly one service policy may be applied to a given zone pair at any given time. 
If you apply a different service policy to a zone pair that already has a service policy, you will overwrite the previous service policy.


4) Default Policies, Traffic Flows, and Zone Interaction:

The membership of the router network interfaces in zones is subject to several rules governing interface behavior as is the traffic moving between zone member interfaces:


a) A zone must be configured before you can assign interfaces to the zone.
b) You can assign an interface to only one security zone.
c) Traffic is implicitly allowed to flow by default among interfaces that are members of the same zone.
d) To permit traffic to and from a zone member interface, a policy allowing or inspecting traffic must be configured between that zone and any other zone.
e) Traffic cannot flow between a zone member interface and any interface that is not a zone member. 
   You can apply pass, inspect, and drop actions only between two zones.
f) Interfaces that have not been assigned to a zone function as classical router ports and might still use legacy stateful inspection configuration.
g) If you do not want an interface on the router to be part of the zone-based firewall policy, it might be necessary to put that interface in a zone and configure a "pass all" policy between that zone and any other zone to which traffic flow is desired.
h) From the preceding rules, it follows that if traffic is to flow among all the interfaces in a router, all the interfaces must be part of the zoning model (each interface must be a member of a zone).

When an interface is configured to be a zone member, the hosts that are connected to the interface are included in the zone, but traffic flowing to and from the interfaces of the router is not controlled by the zone policies. Instead, all the IP interfaces on the router are automatically made part of the self zone when a zone-based policy firewall is configured.
In order to limit IP traffic moving to the IP addresses of the router from the various zones on a router, policies must be applied to block, allow, or inspect traffic between the zone and the self zone of the router, and vice versa. If there are no policies between a zone and the self zone, all traffic is permitted to the interfaces of the router without being inspected.
If desired, you can define a policy using the self zone as either the source or destination zone. The self zone is a system-defined zone. It does not require any interfaces to be configured as members. 
A zone pair that includes the self zone, along with the associated policy, applies to traffic that is directed to the router or traffic that the router generates. It does not apply to traffic traversing the router.
The following are additional rules for zone-based policy firewalls that govern interface behavior when the router is involved in the traffic flow:
All traffic to and from a given interface is implicitly blocked when the interface is assigned to a zone, except traffic to or from other interfaces in the same zone, and traffic to any interface on the router.
All the IP interfaces on the router are automatically made part of the self zone when a zone-based policy firewall is configured. The self zone is the only exception to the default deny-all policy. All traffic to any router interface is allowed until traffic is explicitly denied.
The only exception to the "deny by default" approach is the traffic to and from the router itself. This traffic is permitted by default. You can configure an explicit policy to restrict such traffic.


If desired, you can define a policy using the self zone as either the source or destination zone. The self zone is a system-defined zone. It does not require any interfaces to be configured as members. A zone pair that includes the self zone, along with the associated policy, applies to traffic that is directed to the router or traffic that the router generates. It does not apply to traffic traversing the router.
The following are additional rules for zone-based policy firewalls that govern interface behavior when the router is involved in the traffic flow:
All traffic to and from a given interface is implicitly blocked when the interface is assigned to a zone, except traffic to or from other interfaces in the same zone, and traffic to any interface on the router.
All the IP interfaces on the router are automatically made part of the self zone when a zone-based policy firewall is configured. The self zone is the only exception to the default deny-all policy. All traffic to any router interface is allowed until traffic is explicitly denied.
The only exception to the "deny by default" approach is the traffic to and from the router itself. This traffic is permitted by default. You can configure an explicit policy to restrict such traffic.


Cisco IOS Zone-Based Policy Firewall: Design Considerations

These factors should be considered when designing Cisco IOS zone-based policy firewalls.
An interface can be assigned to only one zone.
An interface pair can be assigned only one policy.
Consider default traffic flows for interfaces without zones, traffic flows between zones, and traffic flows to or from the router interfaces themselves.
Inspection actions cannot be applied to the class-default class.
Remember that the default policy action for unclassified traffic is drop.

5) Cisco Common Classification Policy Language Configuration Overview:

The following procedure can be used to configure a zone-based policy firewall. 
In some circumstances, certain steps can be completed out of order, but some components may be dependent on others.
For instance, you must configure a class map before you can reference it in a policy map. 
Similarly, you cannot assign a policy map to a zone pair unless the policy map is already configured. 
If you try to configure a section that relies on another portion of the configuration that you have not configured, the router responds with an error message.

1) Define zones.
2) Define zone pairs.
3) Define class maps that describe traffic that must have policy which will be applied as it crosses a zone pair.
4) Define policy maps to apply action to the traffic of your class map.
5) Apply policy maps to zone pairs.
6) Assign interfaces to zones.


































